# データ仕様書

## ファイル共通仕様

### ファイル構造（必須）
```
1行目: 備考行（説明文、処理日付など）
2行目: カラム名（ヘッダー）
3行目〜: 実データ
```

⚠️ **重要**: Pandasで読み込む際は `header=1` を指定（2行目をヘッダーとする）

---

## インプット1: 今回データ

### ファイル名
任意（ユーザーがアップロード時に選択）

### カラム定義

| 列 | カラム名 | データ型 | 必須 | 説明 | 処理 |
|----|----------|----------|------|------|------|
| A | stationid | 文字列/数値 | ✅ | 駅ID | そのまま |
| B | name | 文字列 | ✅ | 駅名 | そのまま |
| C | railroad2 | 文字列 | - | 路線名2 | そのまま |
| D | railroad | 文字列 | ✅ | 路線名 | そのまま |
| E | cityid | 文字列/数値 | - | 市区町村ID | そのまま |
| F | priceunitconvnewly | 数値 | - | 新築換算単価 | そのまま |
| G | priceunitnewly | 数値 | - | 新築単価 | そのまま |
| H | priceunitusedsigned | 数値 | - | 中古成約単価 | そのまま |
| I | count | 数値 | - | 件数 | そのまま |
| J | 新築換算平均価格 | - | - | - | **計算結果** |
| K | 新築時平均価格 | - | - | - | **計算結果** |
| L | 中古平均価格 | - | - | - | **計算結果** |
| M | 新築換算ー中古 | - | - | - | **計算結果** |

### データ例
```
# 1行目（備考行）
2025年1月データ

# 2行目（ヘッダー）
stationid, name, railroad2, railroad, cityid, priceunitconvnewly, ...

# 3行目以降（実データ）
1, 東京, JR, JR山手線, 13101, 450000, 500000, 380000, 25, , , , 
```

### 注意事項
- J〜M列は空白で提供される（システムで計算）
- F, G, H列は空白や0の場合がある
- stationid, railroadは必須（マッチングキーのため）

---

## インプット2: 前回データ

### ファイル名
任意（ユーザーがアップロード時に選択）

### カラム定義
**今回データと完全に同一**（A〜M列）

### 重要な違い
- J〜M列も**すでに値が入っている**（過去の処理済みデータ）
- これをそのまま比較に使用する

---

## アウトプット: 出力ファイル

### ファイル名規則
```
output_YYYYMMDD_HHMMSS.xlsx
例: output_20250117_143052.xlsx
```

### シート構成

#### シート1: 前回データ

| 内容 | 処理 |
|------|------|
| 全データ | インプット2をそのままコピー |
| 備考行 | 保持 |
| ヘッダー行 | 保持 |
| データ行 | すべてそのまま |

#### シート2: 今回データ

| 列 | 内容 | 処理 |
|----|------|------|
| A〜I | 元データ | そのまま |
| J | 新築換算平均価格 | **計算** |
| K | 新築時平均価格 | **計算** |
| L | 中古平均価格 | **計算** |
| M | 新築換算ー中古 | **計算** |

#### シート3: 比較データ

| 列 | カラム名 | データ元 | 型 |
|----|----------|----------|----|
| A | stationid | マッチ後 | 文字列/数値 |
| B | name | マッチ後 | 文字列 |
| C | railroad2 | マッチ後 | 文字列 |
| D | railroad | マッチ後 | 文字列 |
| E | cityid | マッチ後 | 文字列/数値 |
| F | 前回新築換算平均価格 | 前回データJ列 | 数値 |
| G | 今回新築換算平均価格 | 今回データJ列 | 数値 |
| H | 差異 | **計算** | 数値 |
| I | 値上げ率 | **計算** | % |

**備考行の内容案:**
```
前回データと今回データの比較（YYYY年MM月処理）
```

---

## データ品質チェック項目

### 必須チェック

- [ ] ファイル拡張子が `.xlsx`
- [ ] 1行目が存在する（備考行）
- [ ] 2行目が存在する（ヘッダー行）
- [ ] A列（stationid）が存在する
- [ ] D列（railroad）が存在する
- [ ] 3行目以降にデータが存在する

### 任意チェック（警告レベル）

- [ ] F, G, H列が数値型である
- [ ] count列（I列）が正の整数である

---

## 次のステップ

**03_計算ロジック仕様書.md を読んで、計算式の詳細を理解してください**