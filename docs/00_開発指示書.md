# 開発指示書 - 必ず最初に読んでください

## プロジェクト名
エクセルデータ加工システム（Streamlit版）

## 開発の進め方

### ⚠️ 重要：必ず順番に読んで開発してください

1. **この開発指示書（00）** ← 今ここ
2. **全体設計書（01）** - システム全体像の把握
3. **データ仕様書（02）** - ファイル構造の理解
4. **計算ロジック仕様書（03）** - 計算式の理解
5. **UI設計書（04）** - 画面仕様の理解
6. **エラーハンドリング仕様書（05）** - エラー処理の理解

↓ ここから実装開始

7. **Excel読み書き実装ガイド（06）** → `utils/excel_handler.py` を作成
8. **計算モジュール実装ガイド（07）** → `modules/calculator.py` を作成
9. **マッチング処理実装ガイド（08）** → `modules/matcher.py` を作成
10. **メイン処理実装ガイド（09）** → `modules/data_processor.py` を作成
11. **UI実装（04を再確認）** → `app.py` を作成

---

## 開発環境セットアップ

### 1. ディレクトリ構造作成
```bash
mkdir -p excel-processing-app/{modules,utils,tests/sample_data,docs/機能別}
cd excel-processing-app
```

### 2. 仮想環境構築
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

### 3. 必須パッケージインストール
```bash
pip install streamlit==1.31.0
pip install pandas==2.2.0
pip install openpyxl==3.1.2
pip install numpy==1.26.3
pip freeze > requirements.txt
```

---

## 実装の進め方（重要）

### 各ファイルの実装順序
```
1. utils/excel_handler.py      # 基盤（他のモジュールが依存）
   ↓
2. modules/calculator.py       # 計算ロジック
   ↓
3. modules/matcher.py          # マッチング処理
   ↓
4. modules/data_processor.py   # メイン処理（上記3つを統合）
   ↓
5. app.py                      # UI（最後）
```

### 各ファイル作成時のルール

✅ **該当する機能別実装ガイドを必ず読んでから作成**
✅ **コピペ禁止：仕様書を理解してから実装**
✅ **1ファイル完成したら動作確認**
✅ **エラーが出たら05_エラーハンドリング仕様書を確認**

---

## テストデータの配置

サンプルデータを以下に配置：
```
tests/sample_data/
├── sample_前回データ.xlsx
└── sample_今回データ.xlsx
```

---

## 開発中の確認事項チェックリスト

### 実装前
- [ ] 01〜05の設計書を全て読んだ
- [ ] データ構造（1行目=備考、2行目=ヘッダー）を理解した
- [ ] マッチングキーが「stationid + railroad」であることを理解した

### 実装中
- [ ] 計算式の係数（0.3025, 70）を正確に使用している
- [ ] エラー時は「データなし」という文字列を代入している
- [ ] 値上げ率は切り上げ（math.ceil）を使用している
- [ ] 備考行（1行目）を保持している

### 実装後
- [ ] サンプルデータで動作確認した
- [ ] 3シートが正しく出力されることを確認した
- [ ] エラーメッセージが適切に表示されることを確認した

---

## よくある実装ミス（事前に確認）

❌ **ヘッダー行を0行目として読み込む**
→ ✅ `pd.read_excel(file, header=1)` を使用

❌ **マッチングキーを1つだけ使う**
→ ✅ `stationid + railroad` の組み合わせを使用

❌ **エラー時にNaNやNoneを代入**
→ ✅ 文字列「データなし」を代入

❌ **値上げ率を四捨五入**
→ ✅ `math.ceil()` で切り上げ

❌ **比較シートで片方のみ存在するデータを除外**
→ ✅ 必ず含める（空白で表示）

---

## 次のステップ

**01_全体設計書.md を読んでください**